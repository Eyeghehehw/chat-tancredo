<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Tancredo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin: 0;
    transition: background 0.3s, color 0.3s;
  }

  header {
    padding: 15px;
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
    transition: background 0.3s, color 0.3s;
  }

  #chat {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition: background 0.3s;
  }

  .message {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 12px;
    word-wrap: break-word;
    line-height: 1.4;
    opacity: 0;
    transform: translateX(-50px);
    animation: slideIn 0.4s forwards;
  }

  .user { align-self: flex-end; background: #007bff; color: #fff; }
  .bot { align-self: flex-start; background: #28a745; color: #fff; }

  @keyframes slideIn {
    to { opacity: 1; transform: translateX(0); }
  }

  #inputArea {
    display: flex;
    padding: 10px;
  }

  #userInput {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid #007bff;
    font-size: 16px;
  }

  #sendBtn, #themeBtn, #clearBtn {
    padding: 10px 15px;
    margin-left: 5px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }

  footer {
    text-align: right;
    padding: 5px 15px;
    font-size: 0.9em;
    color: gray;
  }

  #fraseMotivacional {
    text-align: center;
    font-style: italic;
    color: #555;
    margin-bottom: 5px;
  }

  body.claro { background: #f5f5f5; color: #000; }
  body.claro header { background: #007bff; color: #fff; }
  body.claro #chat { background: #fff; }
  body.claro #sendBtn { background: #007bff; color: #fff; }
  body.claro #themeBtn { background: #6c757d; color: #fff; }
  body.claro #clearBtn { background: #dc3545; color: #fff; }

  body.escuro { background: #1e1e1e; color: #fff; }
  body.escuro header { background: #333; color: #fff; }
  body.escuro #chat { background: #2c2c2c; }
  body.escuro .user { background: #3399ff; color: #fff; }
  body.escuro .bot { background: #33cc77; color: #fff; }
  body.escuro #userInput { border-color: #3399ff; background: #444; color: #fff; }
  body.escuro #sendBtn { background: #3399ff; color: #fff; }
  body.escuro #themeBtn { background: #ff9900; color: #fff; }
  body.escuro #clearBtn { background: #dc3545; color: #fff; }
</style>
</head>
<body class="claro">

<header>ðŸ¤– Chat Tancredo</header>

<div id="fraseMotivacional"></div>
<div id="chat"></div>

<div id="inputArea">
  <input type="text" id="userInput" placeholder="Digite algo..." autofocus>
  <button id="sendBtn">Enviar</button>
  <button id="clearBtn">Limpar</button>
  <button id="themeBtn">Tema</button>
</div>

<footer>By: Gabriel Almeida 1 - EMTI</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const themeBtn = document.getElementById("themeBtn");
const clearBtn = document.getElementById("clearBtn");
const fraseDiv = document.getElementById("fraseMotivacional");

let temaAtual = 0;
const temas = ["claro","escuro"];
let conversa = [];

const frasesMotivacionaisOriginais = [
  "Acredite em vocÃª e tudo serÃ¡ possÃ­vel!",
  "Pequenos passos tambÃ©m levam longe.",
  "Nunca Ã© tarde para recomeÃ§ar.",
  "VocÃª Ã© mais forte do que imagina.",
  "FaÃ§a hoje algo que seu futuro agradeÃ§a."
];
let frasesMotivacionais = [...frasesMotivacionaisOriginais];

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = "message " + sender;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;

  if (frasesMotivacionais.length === 0) frasesMotivacionais = [...frasesMotivacionaisOriginais];
  const idx = Math.floor(Math.random() * frasesMotivacionais.length);
  fraseDiv.textContent = frasesMotivacionais[idx];
  frasesMotivacionais.splice(idx,1);
}

// ðŸ”¹ FunÃ§Ãµes para equaÃ§Ã£o de 2Âº grau
function normalizarTexto(s) {
  return s
    .replace(/,/g, ".")
    .replace(/Ã—/g, "x")
    .replace(/X/g, "x")
    .replace(/â€“|â€”/g, "-")
    .replace(/\s+/g, " ")
    .trim();
}
function numeroOuDefault(str, def = 1) {
  if (str === "" || str === "+") return +def;
  if (str === "-") return -def;
  const n = parseFloat(str);
  return isNaN(n) ? def : n;
}
function parseQuadratica(input) {
  let s = normalizarTexto(input).toLowerCase();
  s = s.replace(/xÂ²/g, "x^2");
  const tokens = s.split(" ").filter(Boolean);

  let termos = [];
  if (tokens.length === 1) {
    const unico = tokens[0]
      .replace(/-/g, " -")
      .replace(/\+/g, " +")
      .trim();
    termos = unico.split(" ").filter(Boolean);
  } else {
    termos = tokens;
  }

  let a = 0, b = 0, c = 0;
  for (const tRaw of termos) {
    const t = tRaw.replace(/\s/g, "");
    if (!t) continue;

    let m = t.match(/^([+\-]?\d*\.?\d*)x\^?2$/);
    if (m) { a = numeroOuDefault(m[1], 1); continue; }

    m = t.match(/^([+\-]?\d*\.?\d*)x$/);
    if (m) { b = numeroOuDefault(m[1], 1); continue; }

    m = t.match(/^[+\-]?\d*\.?\d+$/);
    if (m) { c += parseFloat(t); continue; }
  }

  if (a === 0 && b === 0 && c === 0) return null;
  if (a === 0) return null;
  return { a, b, c };
}
function equacaoSegundoGrau(a,b,c){
  const delta = b*b - 4*a*c;
  if (delta < 0) return "A equaÃ§Ã£o nÃ£o tem raÃ­zes reais ðŸ˜¿";
  if (delta === 0) return `A raiz dupla Ã© ${-b/(2*a)}`;
  let x1 = (-b + Math.sqrt(delta))/(2*a);
  let x2 = (-b - Math.sqrt(delta))/(2*a);
  return `As raÃ­zes sÃ£o ${x1} e ${x2} (Î”=${delta})`;
}

// ðŸ”¹ Avaliar expressÃµes
function calcularExpressao(msg) {
  try {
    msg = msg.replace(/\bvezes\b|x/g,'*')
             .replace(/\bmais\b/g,'+')
             .replace(/\bmenos\b/g,'-')
             .replace(/\bdividido por\b/g,'/');
    if(/^[0-9+\-*/().\s]+$/.test(msg)){
      return "Resultado: " + eval(msg);
    }
  } catch {}
  return null;
}

function botResponse(msg){
  msg = msg.toLowerCase().trim();

  if (msg.includes("mal") || msg.includes("triste") || msg.includes("depressivo")) {
    return "Conversa com o Greguinho ðŸ’•";
  }

  // EquaÃ§Ã£o de 2Âº grau (ex: "2xÂ² 2x 6")
  const parsed = parseQuadratica(msg);
  if(parsed) return equacaoSegundoGrau(parsed.a, parsed.b, parsed.c);

  if (msg.startsWith("potencia")) {
    let parts = msg.split(" ");
    if(parts.length===3){
      return `${parts[1]} ^ ${parts[2]} = ${Math.pow(parseFloat(parts[1]),parseFloat(parts[2]))}`;
    } else return "Use: potencia base expoente (ex: potencia 2 3)";
  }

  if (msg.startsWith("raiz")) {
    let parts = msg.split(" ");
    if(parts.length===2){
      let valor = parseFloat(parts[1]);
      if(valor<0) return "NÃ£o existe raiz real ðŸ˜¿";
      return `âˆš${valor} = ${Math.sqrt(valor)}`;
    } else return "Use: raiz numero (ex: raiz 25)";
  }

  const resultadoConta = calcularExpressao(msg);
  if(resultadoConta) return resultadoConta;

  if(msg.includes("oi")) return "Oi! Como vocÃª estÃ¡? ðŸ˜„";
  if(msg.includes("tudo bem")) return "Tudo Ã³timo, e vocÃª?";
  if(msg.includes("nome")) return "Eu sou o Chat Tancredo!";

  if(msg.includes("histÃ³rico") || msg.includes("conversa")){
    return conversa.map(c => (c.sender==="user"?"VocÃª: ":"Chatbot: ") + c.text).join("\n");
  }

  const respostas = [
    "Interessante! ðŸ˜Ž",
    "Hmm, me conta mais!",
    "ðŸ’¡ Boa ideia!",
    "ðŸ˜‚ Haha, adorei!",
    "ðŸ¤” Vou pensar sobre isso..."
  ];
  return respostas[Math.floor(Math.random()*respostas.length)];
}

function sendMessage(){
  const userMsg = input.value.trim();
  if(!userMsg) return;

  addMessage(userMsg,"user");
  conversa.push({sender:"user", text:userMsg});

  const resposta = botResponse(userMsg);
  addMessage(resposta,"bot");
  conversa.push({sender:"bot", text:resposta});

  input.value = "";
}

function toggleTheme(){
  temaAtual = (temaAtual + 1) % temas.length;
  document.body.className = temas[temaAtual];
}
function clearChat(){
  chat.innerHTML = "";
  conversa = [];
  frasesMotivacionais = [...frasesMotivacionaisOriginais];
  fraseDiv.textContent = "";
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keypress", e => { if(e.key==="Enter") sendMessage(); });
themeBtn.addEventListener("click", toggleTheme);
clearBtn.addEventListener("click", clearChat);
</script>
</body>
</html>
